/*!CK:3160110992!*//*1401259876,178198825*/

if (self.CavalryLogger) { CavalryLogger.start_js(["ZpuU1"]); }

__d("UIThumbPager",["CSS","DOM","Event","Style","URI","$","copyProperties","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(p,q,r,s,t,u,v){if(!p)return false;this.startTime=this.startTime||Date.now();m(this,{root:l(p),ancestor:s||p.parentNode,thumbs:h.scry(p,'div.UIThumbPager_Thumbs img'),thumbRoot:p.parentNode,loaded:[],index:0,loadCount:0,lastLoadCount:0,orderedLoaded:[],orderedCursor:0,onloadCallback:n,onhideCallback:n,timeout:null,finished:false,minWidth:t,minHeight:u,allowReordering:v,metricsInput:r});this.loader=h.find(this.root,'div.UIThumbPager_Loader');if(q){this.input=h.create('input',{name:q,type:'hidden'});this.ancestor.appendChild(this.input);}this.bestImageW=h.create('input',{name:this.getMetricsInput('best_image_w'),type:'hidden'});this.bestImageH=h.create('input',{name:this.getMetricsInput('best_image_h'),type:'hidden'});this.selectedImage=h.create('input',{name:this.getMetricsInput('image_selected'),type:'hidden'});this.imagesProvided=h.create('input',{name:this.getMetricsInput('images_provided'),type:'hidden',value:this.thumbs.length});this.imagesLoaded=h.create('input',{name:this.getMetricsInput('images_loaded'),type:'hidden',value:0});this.imagesShown=h.create('input',{name:this.getMetricsInput('images_shown'),type:'hidden',value:0});this.loadDuration=h.create('input',{name:this.getMetricsInput('load_duration'),type:'hidden'});this.timedOut=h.create('input',{name:this.getMetricsInput('timed_out'),type:'hidden',value:0});this.sortOrder=h.create('input',{name:this.getMetricsInput('sort_order'),type:'hidden'});this.selectorType=h.create('input',{name:this.getMetricsInput('selector_type'),type:'hidden',value:'UIThumbPager_6'});if(r){this.ancestor.appendChild(this.bestImageW);this.ancestor.appendChild(this.bestImageH);this.ancestor.appendChild(this.selectedImage);this.ancestor.appendChild(this.imagesProvided);this.ancestor.appendChild(this.imagesLoaded);this.ancestor.appendChild(this.imagesShown);this.ancestor.appendChild(this.loadDuration);this.ancestor.appendChild(this.timedOut);this.ancestor.appendChild(this.sortOrder);this.ancestor.appendChild(this.selectorType);}this.root.getUIThumbPager=n.thatReturns(this);}o.prototype.setOnloadCallback=function(p){this.onloadCallback=p;this.init();return this;};o.prototype.setOnhideCallback=function(p){this.onhideCallback=p;return this;};o.prototype.init=function(){this.timeout=setInterval(this.timeoutTriggered.bind(this),o.loadtimeout);this.thumbs.forEach(function(p,q){if(p.complete||p.readyState=="complete"){this.onload(p,q);}else{var r=false,s=function(){if(!r){this.onload(p,q);r=true;}}.bind(this),t=function(){if(!r&&p.readyState=="complete"){this.onload(p,q);r=true;}}.bind(this);i.listen(p,'readystatechange',t);i.listen(p,'load',s);}}.bind(this));};o.prototype.timeoutTriggered=function(){if(this.lastLoadCount==this.loadCount&&!this.finished){this.updateDisplayFromBlock(true);this.timedOut.value=1;this.onfinish();}this.lastLoadCount=this.loadCount;};o.prototype.onload=function(p,q){if(this.finished)return;var r=this.getDimensions(p),s=null;if(this.checkLimits(r))s={thumb:p,w:r[0],h:r[1],index:q};if(this.allowReordering){if(s){this.loaded.push(s);this.onloadCallback(this.loaded.length);}}else{this.orderedLoaded[q]=s;if(this.orderedCursor==q)this.updateDisplayFromBlock(false);}this.imagesLoaded.value=++this.loadCount;if(this.loadCount==this.thumbs.length)this.onfinish();};o.prototype.onfinish=function(){this.markFinished();this.imagesShown.value=this.loaded.length;if(this.allowReordering||this.loaded.length===0)this.loadDuration.value=Date.now()-this.startTime;if(this.loaded.length===0){g.hide(this.root);this.onhideCallback();return;}if(this.allowReordering){this.loaded.sort(this.sort);this.bestImageW.value=this.loaded[0].w;this.bestImageH.value=this.loaded[0].h;this.loaded.forEach(function(p,q){if(q>0)this.sortOrder.value+=',';this.sortOrder.value+=p.index;}.bind(this));this.first();}};o.prototype.markFinished=function(){clearInterval(this.timeout);this.finished=true;};o.prototype.updateDisplayFromBlock=function(p){for(var q=this.orderedCursor;q<this.thumbs.length;q++){if(!p&&this.orderedLoaded[q]===undefined)break;this.orderedCursor++;if(!this.orderedLoaded[q])continue;this.loaded.push(this.orderedLoaded[q]);this.onloadCallback(this.loaded.length);if(this.loaded.length==1){this.first();this.loadDuration.value=Date.now()-this.startTime;this.bestImageW.value=this.loaded[0].w;this.bestImageH.value=this.loaded[0].h;}}this.imagesShown.value=this.loaded.length;};o.prototype.page=function(p,q){if(this.index==p)return true;if(!this.finished&&this.allowReordering){this.markFinished();this.imagesLoaded.value=this.loadCount;this.imagesShown.value=this.loaded.length;}if(this.loader){j.set(this.loader,'display','none');this.loader=null;}var r=this.index;this.index+=q;this.selectedImage.value=this.index;o.swap(this.loaded[r].thumb,this.loaded[this.index].thumb,this.input);if(this.index==p)return true;return false;};o.prototype.first=function(){return this.page(null,-this.index);};o.prototype.prev=function(){return this.page(0,-1);};o.prototype.next=function(){return this.page(this.loaded.length-1,1);};o.prototype.getPageNumber=function(){return this.index+1;};o.swap=function(p,q,r){if(p!==q)g.addClass(p,o.hiddenClass);g.removeClass(q,o.hiddenClass);var s=k(q.src);if(!r)return;if((s.isFacebookURI()||s.getDomain().toLowerCase().match('\\.fbcdn\\.net$'))&&s.getPath().match('/safe_image.php')){r.value=s.getQueryData().url;}else r.value=q.src;};o.prototype.showThumbs=function(p){g.conditionClass(this.thumbRoot,'hidden_elem',!p);};o.prototype.sort=function(p,q){var r=p.w*p.h,s=q.w*q.h;if(s>r||s==r&&q.index<p.index)return 1;return -1;};o.prototype.getDimensions=function(p){return [p.naturalWidth,p.naturalHeight];};o.prototype.checkLimits=function(p){var q=p[0],r=p[1];if(!q)return true;return r>=(this.minHeight||o.minHeight)&&q>=(this.minWidth||o.minWidth)&&r/q<=o.maxRatio&&q/r<=o.maxRatio;};o.prototype.getMetricsInput=function(p){return this.metricsInput+'['+p+']';};m(o,{hiddenClass:'UIThumbPager_Hidden',loadtimeout:5000,minWidth:50,minHeight:50,maxRatio:3});e.exports=o;},null);
__d("legacy:UIThumbPager",["UIThumbPager"],function(a,b,c,d){a.UIThumbPager=b('UIThumbPager');},3);
__d("UIThumbPagerControl",["CSS","DOM","Event","copyProperties","csx","cx","emptyFunction"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){function n(o,p){if(!o)return false;j(this,{root:o,pager:p,buttons:h.find(o,'.UIThumbPagerControl_Buttons'),buttonText:h.find(o,'div.UIThumbPagerControl_Text'),buttonLeft:h.find(o,'.UIThumbPagerControl_Button_Left'),buttonRight:h.find(o,'.UIThumbPagerControl_Button_Right'),loadedCount:0,pageCurrent:h.find(o,'span.UIThumbPagerControl_PageNumber_Current'),pageTotal:h.find(o,'span.UIThumbPagerControl_PageNumber_Total'),noThumb:h.find(o,'.UIThumbPagerControl_NoPicture'),end:true});this.pager.setOnhideCallback(this.onhide.bind(this));this.root.getUIThumbPagerControl=m.thatReturns(this);this.attachHandlers();}n.prototype.attachHandlers=function(){this.pager.setOnloadCallback(this.onload.bind(this));i.listen(this.buttonLeft,'click',function(){this.click(this.pager.prev);}.bind(this));i.listen(this.buttonRight,'click',function(){this.click(this.pager.next);}.bind(this));i.listen(this.noThumb,'click',function(event){var o;if(g.hasClass(this.noThumb,"_1uhe")){g.conditionClass(this.noThumb,'hidden_elem',true);var p=h.find(this.noThumb,"._1uhf");p.checked=1;o=true;}else o=this.noThumb.checked;this.pager.showThumbs(!o);g.conditionClass(this.buttons,'hidden_elem',o);g.conditionClass(this.buttonText,'hidden_elem',o);if(g.hasClass(this.noThumb,"_1uhe")){event.stopPropagation();return false;}}.bind(this));};n.prototype.onload=function(o){this.loadedCount=o;if(o==1)h.setContent(this.pageCurrent,o);if(o>this.pager.getPageNumber())g.removeClass(this.root,'UIThumbPagerControl_Last');h.setContent(this.pageTotal,o);};n.prototype.onhide=function(){g.hide(this.root);this.noThumb.checked=true;};n.prototype.click=function(o){if(this.loadedCount<=1)return;var p=['UIThumbPagerControl_Last','UIThumbPagerControl_First'];if(o==this.pager.prev)p.push(p.shift());if(this.end)g.removeClass(this.root,p[1]);if(this.end=o.bind(this.pager)())g.addClass(this.root,p[0]);h.setContent(this.pageCurrent,this.pager.getPageNumber());};e.exports=n;},null);
__d("legacy:UIThumbPagerControl",["UIThumbPagerControl"],function(a,b,c,d){a.UIThumbPagerControl=b('UIThumbPagerControl');},3);