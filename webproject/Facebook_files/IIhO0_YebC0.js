/*!CK:4251319159!*//*1401162444,178198825*/

if (self.CavalryLogger) { CavalryLogger.start_js(["mOeOk"]); }

__d("ProfilePicCropViewerMixin",["AsyncRequest","DialogX","ProfilePicRequestCreator","ProfilePictureFlowLogging","React","Run","URI","XUIDialogButton.react","XUIDialogBody.react","XUIDialogFooter.react","XUIDialogTitle.react","tx"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s={componentDidMount:function(){this._preventClose=true;l.onBeforeUnload(function(){if(this.isMounted()&&!this._shouldAllowClose())return "You have unsaved changes that will be lost if you leave the page.";}.bind(this),true);this._logFlowStep(j.step.VIEWER_INIT);},componentDidUpdate:function(t,u){if(!u.photoData&&this.state.photoData)this._logFlowStep(this.state.photoData.previousprofilepic?j.step.PREVIOUS_PIC_INIT:j.step.CROP);},getViewerID:function(){return this.props.setid;},_forceClose:function(){this._preventClose=false;this._warningDialog&&this._warningDialog.destroy();this._warningDialog=null;this.close();this._logFlowStep(j.step.CANCEL);},handleCancel:function(){if(!this.props.warnOnCancel||this._shouldAllowClose())return this._forceClose();this._showCloseWarning();},handleSave:function(){this.setState({savingMode:true});this._preventClose=false;this._logFlowStep(j.step.LOADING);var t=this.state.photoData.id;if(this.state.photoData.previousprofilepic){new g('/ajax/timeline/make_profile_pic.php').setData({photo_id:parseInt(t,10)}).setHandler(this.close.bind(this)).setErrorHandler(this.setState.bind(this,{savingMode:false})).send();this._logFlowStep(j.step.PREVIOUS_PIC_SAVING);return;}var u=this.state.photoData.owner.id,v=this.props.profileID;new i(t,u,v,this.getCropArea()).setSuccessURI(new m('profile.php').setQueryData({id:v}).toString()).setErrorURI(m.getRequestURI().toString()).setIsUnscaled(true).send();this._logFlowStep(j.step.CROP_SAVING);},_logFlowStep:function(t){j.setFlowType(this.getFlowType()).log(t);},_shouldAllowClose:function(){return !this._preventClose;},_showCloseWarning:function(){if(!this._warningDialog)this._warningDialog=new h({modal:true,width:400,xui:true},k.DOM.div(null,q(null,"Are you sure you want to leave this page?"),o(null,"You have unsaved changes that will be lost if you leave the page."),p(null,n({action:"cancel",label:"Stay on this Page"}),n({action:"cancel",onClick:this._forceClose,label:"Leave this Page",use:"confirm"}))));this._warningDialog.show();}};e.exports=s;},null);